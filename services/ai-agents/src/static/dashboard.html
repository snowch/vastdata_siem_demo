<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Agent Analysis Dashboard</title>
    
    <!-- Clean CSS - single file -->
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preload main JavaScript module -->
    <link rel="modulepreload" href="js/main.js">
</head>
<body>
    <div class="dashboard">
        <!-- Header with connection status, view toggle, and controls -->
        <header class="header">
            <div class="connection-status">
                <span class="status-indicator" id="connectionIndicator"></span>
                <span id="connectionStatus">Connecting...</span>
            </div>
            <button class="debug-toggle" id="debugToggle" title="Toggle debug mode">
                üîß Debug Mode
            </button>
            <button class="view-mode-toggle" onclick="window.socDashboard?.toggleViewMode()" title="Toggle between analyst and executive view">
                üî¨ Analyst View
            </button>
            
            <h1>üõ°Ô∏è SOC Agent Analysis Dashboard</h1>
            <p>Multi-agent security log analysis with technical details for analyst decision-making</p>
            
            <div class="controls">
                <button class="btn btn-secondary" id="retrieveBtn" title="Retrieve security logs">
                    üì• Retrieve Logs
                </button>
                <button class="btn btn-primary" id="analyzeBtn" title="Start security analysis">
                    üöÄ Start Analysis
                </button>
                <button class="btn" id="exportBtn" 
                        style="background: linear-gradient(45deg, #8e44ad, #9b59b6); color: white;"
                        title="Export analysis results (Ctrl+Shift+E)">
                    üìÑ Export Results
                </button>
                <button class="btn" id="clearBtn" 
                        style="background: linear-gradient(45deg, #95a5a6, #7f8c8d); color: white;"
                        title="Clear all results">
                    üßπ Clear Results
                </button>
            </div>
        </header>

        <!-- Input section -->
        <section class="input-section">
            <h3>
                Security Logs Input
                <span class="log-counter" id="logCounter">0 events</span>
            </h3>
            <textarea id="logInput" 
                      placeholder="Retrieved security logs will appear here, or paste your own OCSF logs..."
                      aria-label="Security logs input"></textarea>
        </section>

        <!-- Progress tracking -->
        <div class="progress-bar" role="progressbar" aria-live="polite">
            <div class="progress-fill" id="progressBar"></div>
            <div class="progress-text" id="progressText">Ready</div>
        </div>

        <!-- Agent workflow section -->
        <main class="workflow-container">
            <!-- Triage Agent -->
            <article class="agent-card" id="triageCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>üö® Triage Specialist</h3>
                            <p>Initial threat identification and prioritization with technical analysis</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="triageStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="triageSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="triageOutput" aria-live="polite">
                        Waiting for analysis to begin...
                    </div>
                </div>
            </article>

            <!-- Context Agent -->
            <article class="agent-card" id="contextCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>üìö Context Research Agent</h3>
                            <p>Historical incident correlation with detailed search analysis</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="contextStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="contextSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="contextOutput" aria-live="polite">
                        Waiting for triage completion...
                    </div>
                </div>
            </article>

            <!-- Senior Analyst -->
            <article class="agent-card" id="analystCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>üéØ Senior Analyst</h3>
                            <p>Deep analysis with comprehensive technical recommendations</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="analystStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="analystSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="analystOutput" aria-live="polite">
                        Waiting for context research...
                    </div>
                </div>
            </article>
        </main>

        <!-- Results Panel (hidden by default) -->
        <section class="findings-panel" id="findingsPanel" style="display: none;">
            <h3>üéØ Comprehensive Analysis Results</h3>
            <div class="findings-grid" id="findingsContent">
                <!-- Results will be populated by FindingsManager -->
            </div>
        </section>

        <!-- Debug Panel -->
        <aside class="debug-panel" id="debugPanel" aria-hidden="true">
            <h3>üîß Debug Console</h3>
            <div class="debug-controls">
                <button class="debug-btn" data-action="clearDebugLog">Clear Log</button>
                <button class="debug-btn" data-action="exportDebugLog">Export Log</button>
                <button class="debug-btn" data-action="showWebSocketStats">WebSocket Stats</button>
                <button class="debug-btn" data-action="testConnection">Test Connection</button>
            </div>
            <div class="debug-log" id="debugLog" aria-live="polite">
                Debug mode disabled. Click "Debug Mode" to enable logging.
            </div>
        </aside>
    </div>

    <!-- Toast notifications container -->
    <div id="toast-container" aria-live="polite"></div>

    <!-- Screen reader announcements -->
    <div id="sr-announcements" aria-live="assertive" style="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;"></div>

    <!-- Clean JavaScript - single entry point -->
    <script type="module" src="js/main.js"></script>

    <!-- Fallback for browsers without module support -->
    <script nomodule>
        document.body.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #e74c3c; background: white;">
                <h2>‚ö†Ô∏è Browser Not Supported</h2>
                <p>This dashboard requires a modern browser with ES6 module support.</p>
                <p>Please update your browser or use Chrome, Firefox, Safari, or Edge.</p>
            </div>
        `;
    </script>
</body>
</html>