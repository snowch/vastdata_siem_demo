<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Agent Analysis Dashboard - Refactored</title>
    
    <!-- Simplified CSS loading - single main file -->
    <link rel="stylesheet" href="css/main.css">
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preload critical JavaScript modules -->
    <link rel="modulepreload" href="js/main.js">
    <link rel="modulepreload" href="js/modules/event-manager.js">
    <link rel="modulepreload" href="js/modules/keyboard-manager.js">
    <link rel="modulepreload" href="js/modules/ui-helper.js">
</head>
<body>
    <div class="dashboard">
        <!-- Header with connection status and controls -->
        <header class="header module-component">
            <div class="connection-status">
                <span class="status-indicator" id="connectionIndicator"></span>
                <span id="connectionStatus">Connecting...</span>
            </div>
            <button class="debug-toggle" id="debugToggle" title="Toggle debug mode">
                üîß Debug Mode
            </button>
            
            <h1>üõ°Ô∏è SOC Agent Analysis Dashboard</h1>
            <p>Refactored multi-agent security log analysis with modular architecture</p>
            
            <div class="controls">
                <button class="btn btn-secondary" id="retrieveBtn" title="Retrieve security logs">
                    üì• Retrieve Logs
                </button>
                <button class="btn btn-primary" id="analyzeBtn" title="Start security analysis">
                    üöÄ Start Analysis
                </button>
                <button class="btn" id="clearBtn" 
                        style="background: var(--neutral-gradient); color: white;"
                        title="Clear all results">
                    üßπ Clear Results
                </button>
            </div>
        </header>

        <!-- Input section -->
        <section class="input-section module-component">
            <h3>
                Security Logs Input
                <span class="log-counter" id="logCounter">0 events</span>
            </h3>
            <textarea id="logInput" 
                      placeholder="Retrieved security logs will appear here, or paste your own OCSF logs..."
                      aria-label="Security logs input"></textarea>
        </section>

        <!-- Progress tracking -->
        <div class="progress-bar" role="progressbar" aria-live="polite">
            <div class="progress-fill" id="progressBar"></div>
            <div class="progress-text" id="progressText">Ready</div>
        </div>

        <!-- Agent workflow section -->
        <main class="workflow-container">
            <!-- Triage Agent -->
            <article class="agent-card module-component" id="triageCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Triage Specialist</h3>
                            <p>Initial threat identification and prioritization</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="triageStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="triageSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="triageOutput" aria-live="polite">
                        Waiting for analysis to begin...
                    </div>
                </div>
            </article>

            <!-- Context Agent -->
            <article class="agent-card module-component" id="contextCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Context Research Agent</h3>
                            <p>Historical incident correlation and pattern matching</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="contextStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="contextSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="contextOutput" aria-live="polite">
                        Waiting for triage completion...
                    </div>
                </div>
            </article>

            <!-- Senior Analyst -->
            <article class="agent-card module-component" id="analystCard">
                <header class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Senior Analyst</h3>
                            <p>Deep analysis and actionable recommendations</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="analystStatus">Pending</div>
                </header>
                <div class="agent-content">
                    <div class="loading-spinner" id="analystSpinner" aria-hidden="true">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="analystOutput" aria-live="polite">
                        Waiting for context research...
                    </div>
                </div>
            </article>
        </main>

        <!-- Debug Panel -->
        <aside class="debug-panel module-component" id="debugPanel" style="display: none;" aria-hidden="true">
            <h3>üîß Debug Console</h3>
            <div class="debug-controls">
                <button class="debug-btn" data-action="clearDebugLog">Clear Log</button>
                <button class="debug-btn" data-action="exportDebugLog">Export Log</button>
                <button class="debug-btn" data-action="showWebSocketStats">WebSocket Stats</button>
                <button class="debug-btn" data-action="testConnection">Test Connection</button>
            </div>
            <div class="debug-log" id="debugLog" aria-live="polite">
                Debug mode enabled. WebSocket logs will appear here...
            </div>
        </aside>

        <!-- Results Panel -->
        <section class="findings-panel module-component" id="findingsPanel" style="display: none;">
            <h3>
                üéØ Analysis Results
                <span class="priority-indicator" id="priorityIndicator">Unknown</span>
            </h3>
            <div class="findings-grid" id="findingsContent">
                <!-- Results will be populated here -->
            </div>
        </section>
    </div>

    <!-- Toast notifications container -->
    <div id="toast-container" aria-live="polite"></div>

    <!-- Screen reader announcements -->
    <div id="sr-announcements" aria-live="assertive" class="visually-hidden"></div>

    <!-- Modular JavaScript - ES6 modules -->
    <script type="module">
        // Import and initialize the main dashboard
        import('./js/main.js').catch(error => {
            console.error('Failed to load dashboard modules:', error);
            document.body.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #e74c3c;">
                    <h2>‚ö†Ô∏è Dashboard Load Error</h2>
                    <p>Failed to load the dashboard modules. Please refresh the page.</p>
                    <button onclick="location.reload()" style="padding: 0.5rem 1rem; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üîÑ Refresh Page
                    </button>
                </div>
            `;
        });
    </script>

    <!-- Fallback for browsers without module support -->
    <script nomodule>
        document.body.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #e74c3c;">
                <h2>‚ö†Ô∏è Browser Not Supported</h2>
                <p>This dashboard requires a modern browser with ES6 module support.</p>
                <p>Please update your browser or use Chrome, Firefox, Safari, or Edge.</p>
            </div>
        `;
    </script>
</body>
</html>