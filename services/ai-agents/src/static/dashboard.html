<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Agent Analysis Dashboard - WebSocket</title>
    
    <!-- Refactored CSS Files - Load in Order -->
    <!-- Base styles first -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <!-- Core components -->
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/agents.css">
    
    <!-- Feature-specific styles -->
    <link rel="stylesheet" href="css/approval.css">
    <link rel="stylesheet" href="css/findings.css">
    <link rel="stylesheet" href="css/debug.css">
    <link rel="stylesheet" href="css/notifications.css">
    
    <!-- Effects and responsive - load last -->
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="connection-status">
                <span class="status-indicator" id="connectionIndicator"></span>
                <span id="connectionStatus">Connecting...</span>
            </div>
            <button class="debug-toggle" id="debugToggle">
                üîß Debug Mode
            </button>
            <h1>üõ°Ô∏è SOC Agent Analysis Dashboard</h1>
            <p>Real-time multi-agent security log analysis</p>
            <div class="controls">
                <button class="btn btn-secondary" id="retrieveBtn">
                    üì• Retrieve Logs
                </button>
                <button class="btn btn-primary" id="analyzeBtn">
                    üöÄ Start Analysis
                </button>
                <button class="btn" id="clearBtn" style="background: var(--neutral-gradient); color: white;">
                    üßπ Clear Results
                </button>
            </div>
        </div>

        <div class="input-section">
            <h3>
                Security Logs Input
                <span class="log-counter" id="logCounter">0 events</span>
            </h3>
            <textarea id="logInput" placeholder="Retrieved security logs will appear here, or paste your own OCSF logs..."></textarea>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
            <div class="progress-text" id="progressText">Ready</div>
        </div>

        <div class="workflow-container">
            <!-- Triage Agent Card -->
            <div class="agent-card" id="triageCard">
                <div class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Triage Specialist</h3>
                            <p>Initial threat identification and prioritization</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="triageStatus">Pending</div>
                </div>
                <div class="agent-content">
                    <div class="loading-spinner" id="triageSpinner">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="triageOutput">Waiting for analysis to begin...</div>
                </div>
            </div>

            <!-- Context Agent Card -->
            <div class="agent-card" id="contextCard">
                <div class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Context Research Agent (Vector DB)</h3>
                            <p>Historical incident correlation and pattern matching</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="contextStatus">Pending</div>
                </div>
                <div class="agent-content">
                    <div class="loading-spinner" id="contextSpinner">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="contextOutput">Waiting for triage completion...</div>
                </div>
            </div>

            <!-- Senior Analyst Card -->
            <div class="agent-card" id="analystCard">
                <div class="agent-header">
                    <div class="agent-info">
                        <div class="agent-details">
                            <h3>Senior Analyst</h3>
                            <p>Deep analysis and actionable recommendations</p>
                        </div>
                    </div>
                    <div class="status-badge status-pending" id="analystStatus">Pending</div>
                </div>
                <div class="agent-content">
                    <div class="loading-spinner" id="analystSpinner">
                        <div class="spinner"></div>
                    </div>
                    <div class="agent-output" id="analystOutput">Waiting for context research...</div>
                </div>
            </div>
        </div>

        <!-- Debug Panel -->
        <div class="debug-panel" id="debugPanel" style="display: none;">
            <h3>üîß Debug Console</h3>
            <div class="debug-controls">
                <button class="debug-btn" data-action="clearDebugLog">Clear Log</button>
                <button class="debug-btn" data-action="exportDebugLog">Export Log</button>
                <button class="debug-btn" data-action="showWebSocketStats">WebSocket Stats</button>
                <button class="debug-btn" data-action="testConnection">Test Connection</button>
            </div>
            <div class="debug-log" id="debugLog">Debug mode enabled. WebSocket logs will appear here...</div>
        </div>

        <!-- Findings Panel -->
        <div class="findings-panel" id="findingsPanel" style="display: none;">
            <h3>
                üéØ Analysis Results
                <span class="priority-indicator" id="priorityIndicator">Unknown</span>
            </h3>
            <div class="findings-grid" id="findingsContent">
                <!-- Findings will be populated here -->
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <!-- Load all modules first -->
    <script src="js/debugLogger.js" type="module"></script>
    <script src="js/progressManager.js" type="module"></script>
    <script src="js/eventHandlers.js" type="module"></script>
    <script src="js/websocket.js" type="module"></script>
    <script src="js/approvalWorkflow.js" type="module"></script>
    <script src="js/ui.js" type="module"></script>
    
    <!-- Main script that sets up event listeners - load last -->
    <script src="js/main.js" type="module"></script>
</body>
</html>